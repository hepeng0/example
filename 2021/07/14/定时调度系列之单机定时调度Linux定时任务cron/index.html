<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="定时调度系列之单机定时调度Linux定时任务cron"><meta name="keywords" content="定时调度"><meta name="author" content="何鹏 [smile.hepeng@qq.com]"><meta name="copyright" content="何鹏 [smile.hepeng@qq.com]"><title>定时调度系列之单机定时调度Linux定时任务cron | 沉默者</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><link rel="alternate" href="/atom.xml" title="沉默者" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">1.</span> <span class="toc-text">名词解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">软件包安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bcrond%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E8%BF%90%E8%A1%8C"><span class="toc-number">2.1.</span> <span class="toc-text">查看crond服务是否运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#crond%E6%9C%8D%E5%8A%A1%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">crond服务操作命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">3.</span> <span class="toc-text">配置定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#crontab%E4%BB%BB%E5%8A%A1%E9%85%8D%E7%BD%AE%E5%9F%BA%E6%9C%AC%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">crontab任务配置基本格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cron%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">cron实现原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E5%9B%BE%E8%A7%A3"><span class="toc-number">4.1.</span> <span class="toc-text">基本原理图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E8%AF%A1%E5%BC%82%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.</span> <span class="toc-text">一个诡异的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#crontab%E7%BC%96%E8%BE%91%E5%90%8Ecron%E5%BC%82%E5%B8%B8"><span class="toc-number">4.3.</span> <span class="toc-text">crontab编辑后cron异常</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://img2.baidu.com/it/u=928705063,3876627980&amp;fm=26&amp;fmt=auto&amp;gp=0.jpg"></div><div class="author-info__name text-center">何鹏 [smile.hepeng@qq.com]</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">19</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">20</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">5</span></a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">沉默者</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">定时调度系列之单机定时调度Linux定时任务cron</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-14</time><span class="post-meta__separator">|</span><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/JAVA%E5%BC%80%E5%8F%91/"> JAVA开发</a><span class="post-meta__separator">|</span><span class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2.2k</span><span class="post-meta__separator">|</span><span>Reading time: 8 min</span></span></div><div class="article-container" id="post-content"><p>实现linux定时任务有：cron、anacron、at,使用最多的是cron任务</p>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ul>
<li>cron–服务名；</li>
<li>crond–linux下用来周期性的执行某种任务或等待处理某些事件的一个守护进程，与windows下的计划任务类似；</li>
<li>crontab–是定制好的计划任务表，一个设置cron的工具</li>
</ul>
<h2 id="软件包安装"><a href="#软件包安装" class="headerlink" title="软件包安装"></a>软件包安装</h2><p>要使用cron服务，先要安装vixie-cron软件包和crontabs软件包，两个软件包作用如下：</p>
<ul>
<li>vixie-cron软件包是cron的主程序。<ul>
<li>查看是否安装了cron软件包: rpm -qa|grep vixie-cron</li>
</ul>
</li>
<li>crontabs软件包是用来安装、卸装、或列举用来驱动 cron 守护进程的表格的程序。<ul>
<li>查看是否安装了crontabs软件包:rpm -qa|grep crontabs</li>
</ul>
</li>
</ul>
<p>如果没有安装，则执行如下命令安装软件包(软件包必须存在)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh vixie-cron-4.1-54.FC5*</span><br><span class="line">rpm -ivh crontabs*</span><br></pre></td></tr></table></figure>

<p>如果本地没有安装包，在能够连网的情况下可以在线安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install vixie-cron</span><br><span class="line">yum install crontabs</span><br></pre></td></tr></table></figure>

<h3 id="查看crond服务是否运行"><a href="#查看crond服务是否运行" class="headerlink" title="查看crond服务是否运行"></a>查看crond服务是否运行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pgrep crond 或 </span><br><span class="line">/sbin/service crond status 或 </span><br><span class="line">ps -elf|grep crond|grep -v &quot;grep&quot;</span><br></pre></td></tr></table></figure>


<h3 id="crond服务操作命令"><a href="#crond服务操作命令" class="headerlink" title="crond服务操作命令"></a>crond服务操作命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/sbin/service crond start //启动服务  </span><br><span class="line">/sbin/service crond stop //关闭服务  </span><br><span class="line">/sbin/service crond restart //重启服务  </span><br><span class="line">/sbin/service crond reload //重新载入配置</span><br></pre></td></tr></table></figure>

<h2 id="配置定时任务"><a href="#配置定时任务" class="headerlink" title="配置定时任务"></a>配置定时任务</h2><p>cron有两个配置文件，一个是一个全局配置文件（/etc/crontab），是针对系统任务的；一组是crontab命令生成的配置文件（/var/spool/cron下的文件），是针对某个用户的.定时任务配置到任意一个中都可以。</p>
<p>查看全局配置文件配置情况: <code>cat /etc/crontab</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">　---------------------------------------------</span><br><span class="line">　　SHELL=/bin/bash</span><br><span class="line">　　PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">　　MAILTO=root</span><br><span class="line">　　HOME=/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">　　#</span><span class="bash"> run-parts</span></span><br><span class="line">　　01 * * * * root run-parts /etc/cron.hourly</span><br><span class="line">　　02 4 * * * root run-parts /etc/cron.daily</span><br><span class="line">　　22 4 * * 0 root run-parts /etc/cron.weekly</span><br><span class="line">　　42 4 1 * * root run-parts /etc/cron.monthly</span><br><span class="line">　　----------------------------------------------</span><br></pre></td></tr></table></figure>

<p>查看用户下的定时任务:crontab -l或cat /var/spool/cron/用户名</p>
<h3 id="crontab任务配置基本格式"><a href="#crontab任务配置基本格式" class="headerlink" title="crontab任务配置基本格式"></a>crontab任务配置基本格式</h3><p><img src="/2021/07/14/%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E5%8D%95%E6%9C%BA%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1cron/img.png" alt="img.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------------------------</span><br><span class="line">*   *　 *　 *　 *　　command</span><br><span class="line">分钟(0-59)　小时(0-23)　日期(1-31)　月份(1-12)　星期(0-6,0代表星期天)　 命令</span><br><span class="line">第1列表示分钟1～59 每分钟用*或者 */1表示</span><br><span class="line">第2列表示小时1～23（0表示0点）</span><br><span class="line">第3列表示日期1～31</span><br><span class="line">第4列表示月份1～12</span><br><span class="line">第5列标识号星期0～6（0表示星期天）</span><br><span class="line">第6列要运行的命令</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">在以上任何值中，星号（*）可以用来代表所有有效的值。譬如，月份值中的星号意味着在满足其它制约条件后每月都执行该命令。</span><br><span class="line">整数间的短线（-）指定一个整数范围。譬如，1-4 意味着整数 1、2、3、4。</span><br><span class="line">用逗号（,）隔开的一系列值指定一个列表。譬如，3, 4, 6, 8 标明这四个指定的整数。</span><br><span class="line">正斜线（/）可以用来指定间隔频率。在范围后加上 /&lt;integer&gt; 意味着在范围内可以跳过 integer。譬如，0-59/2 可以用来在分钟字段定义每两分钟。间隔频率值还可以和星号一起使用。例如，*/3 的值可以用在月份字段中表示每三个月运行一次任务。</span><br><span class="line">开头为井号（#）的行是注释，不会被处理</span><br><span class="line">-----------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<details>
<summary>使用实例</summary>
<pre><code>实例1：每1分钟执行一次command
命令：* * * * * command

<p>实例2：每小时的第3和第15分钟执行<br>命令：3,15 * * * * command</p>
<p>实例3：在上午8点到11点的第3和第15分钟执行<br>命令：3,15 8-11 * * * command</p>
<p>实例4：每隔两天的上午8点到11点的第3和第15分钟执行<br>命令：3,15 8-11 */2 * * command</p>
<p>实例5：每个星期一的上午8点到11点的第3和第15分钟执行<br>命令：3,15 8-11 * * 1 command</p>
<p>实例6：每晚的21:30重启smb<br>命令：30 21 * * * /etc/init.d/smb restart</p>
<p>实例7：每月1、10、22日的4 : 45重启smb<br>命令：45 4 1,10,22 * * /etc/init.d/smb restart</p>
<p>实例8：每周六、周日的1 : 10重启smb<br>命令：10 1 * * 6,0 /etc/init.d/smb restart</p>
<p>实例9：每天18 : 00至23 : 00之间每隔30分钟重启smb<br>命令：0,30 18-23 * * * /etc/init.d/smb restart</p>
<p>实例10：每星期六的晚上11 : 00 pm重启smb<br>命令：0 23 * * 6 /etc/init.d/smb restart</p>
<p>实例11：每一小时重启smb<br>命令：* */1 * * * /etc/init.d/smb restart</p>
<p>实例12：晚上11点到早上7点之间，每隔一小时重启smb<br>命令：* 23-7/1 * * * /etc/init.d/smb restart</p>
<p>实例13：每月的4号与每周一到周三的11点重启smb<br>命令：0 11 4 * mon-wed /etc/init.d/smb restart</p>
<p>实例14：一月一号的4点重启smb<br>命令：0 4 1 jan * /etc/init.d/smb restart</p>
<p>实例15：每小时执行/etc/cron.hourly目录内的脚本<br>命令：01   *   *   *   *     root run-parts /etc/cron.hourly<br>说明：<br>run-parts这个参数了，如果去掉这个参数的话，后面就可以写要运行的某个脚本名，而不是目录名了</p></code></pre><p></p>
</details>

<h2 id="cron实现原理"><a href="#cron实现原理" class="headerlink" title="cron实现原理"></a>cron实现原理</h2><h3 id="基本原理图解"><a href="#基本原理图解" class="headerlink" title="基本原理图解"></a>基本原理图解</h3><p>fork 进程 + sleep 轮询<br><img src="/2021/07/14/%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E5%8D%95%E6%9C%BA%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1cron/img_1.png" alt="img_1.png"><br>Cron每分钟做一次检查，看看哪个命令可执行。</p>
<p>从上图可以看到，有4次fork，这4次fork分别是：</p>
<ul>
<li>第一个fork，让Cron自己成为Daemon进程，即成为守护进程；</li>
<li>第二个fork，当Cron检查到有命令需要执行时被创建，但注意它并不执行命令，执行命令由它的子进程来做；</li>
<li>第三个fork，有些版本调用的是vfork，但有些版本却是fork，它是负责执行Cron命令的进程，即会调用execle()的进程；</li>
<li>第四个fork不是必须的，只有为Cron命令配置了标准输入才会用：<br><code>*/1 * * * * /tmp/X/x%1234567890</code><br>像上面有个百分符“%”，后面跟一串，则会有第四个fork，它的作用是将“%”后面的内容作为标准输入传递给第三个fork出来的进程。</li>
</ul>
<p>注意fork出来的进程没有忽略(ignore)管道信号(SIGPIPE)，所以如果遇到SIGPIPE，则会导致进程无声无息的退出，比如标准输主输出重定向管道的读端被关闭了，写时就会触发SIGPIPE。</p>
<p>实践中，可能会遇到child_process()在做上述所说的第三个fork前因SIGPIPE信号退出，导致难以理解的问题。其中一个现象 是：Cron命令被执行了若干次，但之后再也不执行了，原因在于第二个fork出来的进程因SIGPIPE退出了，导致没有进行第三个fork，因此 Cron命令没有被调用(总是由execle()调用)。</p>
<p><img src="/2021/07/14/%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E5%8D%95%E6%9C%BA%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1cron/img_2.png" alt="img_2.png"></p>
<h3 id="一个诡异的问题"><a href="#一个诡异的问题" class="headerlink" title="一个诡异的问题"></a>一个诡异的问题</h3><p>你有可能遇到这样的情况，假设在cron中有如下一条配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/1 * * * * echo hello &gt;&gt; /tmp/hello.txt</span><br></pre></td></tr></table></figure>
<p>观察到它正常运行几次后，就不再运行了，或者一次也不能，但确认无其它问题，因此十分诡异。</p>
<p>这个问题的原因，有可能是因为有共享库Hook了cron，共享库代码触发了SIGPIPE，导致了第二个fork出的进程退出，没来得及执行vfork。</p>
<p>fork出来的子进程，没有对SIGPIPE进行任何处理，默认行为是悄悄退出进程。通过修改/etc/ld.so.preload，可以将共享库注入到非关联的进程中，可通过ldd观察到这种依赖，使用LD_PRELOAD也可以达到同样的效果。</p>
<h3 id="crontab编辑后cron异常"><a href="#crontab编辑后cron异常" class="headerlink" title="crontab编辑后cron异常"></a>crontab编辑后cron异常</h3><p>使用crontab编辑后，cron卡住不动(不是指进程卡住了，而是指命令没有被调用)，原因可能是因为“tcb table full”，最简单的办法是重启cron。</p>
<p>建议避免写下面这样的嵌套命令语句，它有可能导致cron不能正常工作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/1 * * * * echo &quot;`date +%H:%M:%S` hello&quot; &gt;&gt; /tmp/hello.txt</span><br></pre></td></tr></table></figure>
<p>“echo”中嵌套了“date”，可以改成脚本调用，或者不嵌套命令，如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/1 * * * * echo &quot;hello&quot; &gt;&gt; /tmp/hello.txt</span><br></pre></td></tr></table></figure>
<p>一个现象是有一个cron子进程(如下述的14786)不退出了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ps -ef|grep cron</span></span><br><span class="line"></span><br><span class="line">root     10325     1  0 15:08 ?        00:00:00 /usr/sbin/cron</span><br><span class="line">root     14786 10325  0 15:13 ?        00:00:00 /usr/sbin/cron</span><br></pre></td></tr></table></figure>
<p>gdb看到的调用栈为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">0  0xffffe410 <span class="keyword">in</span> __kernel_vsyscall ()</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1  0xb7e88a63 <span class="keyword">in</span> __read_nocancel () from /lib/libc.so.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">2  0xb7e38e38 <span class="keyword">in</span> _IO_file_read_internal () from /lib/libc.so.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">3  0xb7e3a0bb <span class="keyword">in</span> _IO_new_file_underflow () from /lib/libc.so.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">4  0xb7e3a7fb <span class="keyword">in</span> _IO_default_uflow_internal () from /lib/libc.so.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">5  0xb7e3bb2d <span class="keyword">in</span> __uflow () from /lib/libc.so.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">6  0xb7e35b7b <span class="keyword">in</span> getc () from /lib/libc.so.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">7  0x80005d73 <span class="keyword">in</span> ?? () from /usr/sbin/cron</span></span><br></pre></td></tr></table></figure>
<p>strace看到如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> strace -f -p 14786</span></span><br><span class="line"></span><br><span class="line">Process 14786 attached</span><br><span class="line">read(7,</span><br></pre></td></tr></table></figure>
<p>借助lsof可以看到：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cron    14786 root    7r  FIFO        0,6         117960708 pipe</span><br></pre></td></tr></table></figure>
<p>为一个管道，read()挂住的原因可能是因为管道另一端所在进程调用_exit()退出而不是调用exit()退出。</p>
<p>这个时候只有人工kill这个挂起的cron子进程。</p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6/">定时调度</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/07/14/%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E5%8D%95%E6%9C%BA%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6Quartz%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93%E5%8F%8A%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"><i class="fa fa-chevron-left">  </i><span>定时调度系列之单机定时调度Quartz使用总结及原理解析</span></a></div><div class="next-post pull-right"><a href="/2021/07/13/JAVA%E7%BA%BF%E4%B8%8A%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E5%85%A8%E5%A5%97%E8%B7%AF/"><span>JAVA线上故障排查全套路</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '83850031ee87c27765eb',
  clientSecret: '6c5e13a8b6670d5bfa85ba548ba3570cae29e671',
  repo: 'blob-comment',
  owner: 'hepeng0',
  admin: 'hepeng0',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By 何鹏 [smile.hepeng@qq.com]</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>